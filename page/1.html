<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/0e4fe491bf84089c-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/627622453ef56b0d-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/7d8c9b0ca4a64a5a-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/8db47a8bf03b7d2f-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/934c4b7cb736f2a3-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/bee2c35e5d2aa945.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-5497ae65bf9d345f.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-23f6e37ad1d1612c.js" async=""></script><script src="/_next/static/chunks/864-8d9b6481be2de97f.js" async=""></script><script src="/_next/static/chunks/main-app-a9556013570ce939.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-LFDRQZPCBN" as="script"/><title>Been blog - 1</title><meta name="description" content="Been dev-note"/><meta name="google-site-verification" content="BirkRt7C7FYMLW96RbXad2EtPdcl0-_ti9xCRkCHa5U"/><meta name="naver-site-verification" content="58945b2bbe2fe86252fa8c7b204b40f6019920e9"/><meta property="og:title" content="Been blog - 1"/><meta property="og:description" content="Been dev-note - 1"/><meta property="og:url" content="https://wonbeenna.github.io/page/1"/><meta property="og:site_name" content="Been blog"/><meta property="og:image" content="https://wonbeenna.github.io/favicon.png"/><meta property="og:image:width" content="800"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content="Been blog"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Been blog - 1"/><meta name="twitter:description" content="Been dev-note - 1"/><meta name="twitter:image" content="https://wonbeenna.github.io/favicon.png"/><meta name="twitter:image:width" content="800"/><meta name="twitter:image:height" content="600"/><meta name="twitter:image:alt" content="Been blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="192x192"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" noModule=""></script></head><body class="__className_471caf"><header class="sticky top-0 z-10 mx-auto my-0 h-[56px] border-b-[1px] border-b-gray200 bg-white px-[24px] py-0"><section class="m-auto flex h-full max-w-[970px] items-center justify-between"><div class="flex items-center gap-[20px]"><a href="/"><img alt="logo" loading="lazy" width="60" height="56" decoding="async" data-nimg="1" style="color:transparent" src="/assets/icons/been-logo.svg"/></a><div class="flex items-center gap-[20px]"><a href="/about">About</a></div></div><div class="flex items-center gap-[20px]"><a target="_blank" rel="noopener noreferrer" href="https://github.com/wonbeenna"><img alt="github" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/assets/icons/github.svg"/></a><a href="mailto:nwbnwb@naver.com"><img alt="email" loading="lazy" width="34" height="34" decoding="async" data-nimg="1" style="color:transparent" src="/assets/icons/mail.svg"/></a></div></section></header><main class="mx-auto my-0 max-w-[970px] p-[16px]"><section class="flex flex-col-reverse md:relative md:flex-row"><div class="flex flex-1 flex-col"><ol class="relative mx-0 my-[20px] flex w-full  flex-col gap-[40px] p-0"><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/webpack-babel"><img alt="웹팩 기본 사용법 (1)" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/webpack-icon.svg"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">웹팩 기본 사용법 (1)</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">처음 접해보는 웹팩의 원리와 기본 사용 방법</p><span class="text-gray700">2023-11-30</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/rn-geolocation"><img alt="React Native geolocation" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/logo192.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">React Native geolocation</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">React Native 위치정보 받아오기</p><span class="text-gray700">2023-10-25</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/rn-deep-link"><img alt="React Native Deep Linking" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/logo192.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">React Native Deep Linking</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">React Native Deep Linking 연결</p><span class="text-gray700">2023-10-17</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/next-blog"><img alt="Next.js 블로그 만들기" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/Nextjs.svg"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">Next.js 블로그 만들기</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">Next.js로 블로그 만들기</p><span class="text-gray700">2023-10-09</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/jwt-decode"><img alt="jwt 토큰 decode 하기" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/javascript.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">jwt 토큰 decode 하기</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">jwt 토큰 decode 함수</p><span class="text-gray700">2023-08-31</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/audio"><img alt="Audio객체를 이용한 음악 재생" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/logo192.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">Audio객체를 이용한 음악 재생</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">Audio객체를 사용한 기업 과제 구현</p><span class="text-gray700">2023-05-27</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/debouce-throttle"><img alt="디바운싱과 쓰로틀링" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/javascript.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">디바운싱과 쓰로틀링</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">디바운싱과 쓰로틀링의 차이를 구분하고 hook으로 구현</p><span class="text-gray700">2023-05-13</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/graphql-1"><img alt="GraphQl 써보기(1)" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/graphql.svg"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">GraphQl 써보기(1)</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">GraphQl, Apollo Client를 사용</p><span class="text-gray700">2023-04-29</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/study/browser"><img alt="브라우저에 url을 검색하면?" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/javascript.png"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">브라우저에 url을 검색하면?</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">사내 스터디</p><span class="text-gray700">2023-02-25</span></div></a></li><li class="mt-[30px] border-b-[1px] border-b-gray300 pb-[50px] md:mt-[50px] md:pb-[70px]"><a class="hover_card flex w-full flex-col items-center justify-between gap-0 md:flex-row md:gap-[40px]" href="/blog/javaScript/next-middleware"><img alt="Next.js middleware와 getServerSideProps" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="h-[200px] w-[200px] rounded-[14px]" style="color:transparent" src="/assets/postIcon/Nextjs.svg"/><div class="flex min-h-[160px] w-full flex-col items-center justify-center md:min-h-[200px]"><h1 class="my-[12px] overflow-hidden text-ellipsis break-words text-[24px] font-bold text-black md:mt-0 md:text-[34px]">Next.js middleware와 getServerSideProps</h1><p class="mx-[14px] my-[12px] text-ellipsis break-keep text-[14px] text-gray900 md:text-[18px]">세션방식의 로그인 인증, middleware와 getServerSideProps를 사용해 구현한 기록</p><span class="text-gray700">2023-02-22</span></div></a></li></ol><ul class="flex items-center justify-center gap-[10px]"><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] pointer-events-none cursor-not-allowed opacity-50">ᐸ</li><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] rounded-full bg-primaryGradient03 px-[4px] py-[2px] text-white">1</li><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] ">2</li><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] ">3</li><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] ">4</li><li class="box-border flex h-[24px] w-[24px] cursor-pointer items-center justify-center text-[16px] ">ᐳ</li></ul></div><ul class="relative top-0 flex h-fit min-w-fit flex-row flex-wrap gap-[20px] py-[20px] pl-0 md:sticky md:top-[100px] md:flex-col md:flex-nowrap md:py-0 md:pl-[30px]"><h2 class="hidden text-[18px] font-bold md:inline">Category</h2><li><a class="text-gray700" href="/blog/javaScript">javaScript (30)</a></li><li><a class="text-gray700" href="/blog/study">study (2)</a></li><li><a class="text-gray700" href="/blog/til">til (1)</a></li></ul></section></main><footer class="flex items-center justify-center pb-[16px] text-center text-[14px] text-gray600">Copyright © Been.</footer><script src="/_next/static/chunks/webpack-5497ae65bf9d345f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/0e4fe491bf84089c-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/627622453ef56b0d-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/7d8c9b0ca4a64a5a-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/media/8db47a8bf03b7d2f-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n5:HL[\"/_next/static/media/934c4b7cb736f2a3-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n6:HL[\"/"])</script><script>self.__next_f.push([1,"_next/static/css/bee2c35e5d2aa945.css\",\"style\"]\n0:\"$L7\"\n"])</script><script>self.__next_f.push([1,"8:I{\"id\":6054,\"chunks\":[\"272:static/chunks/webpack-5497ae65bf9d345f.js\",\"971:static/chunks/fd9d1056-23f6e37ad1d1612c.js\",\"864:static/chunks/864-8d9b6481be2de97f.js\"],\"name\":\"\",\"async\":false}\na:I{\"id\":1729,\"chunks\":[\"272:static/chunks/webpack-5497ae65bf9d345f.js\",\"971:static/chunks/fd9d1056-23f6e37ad1d1612c.js\",\"864:static/chunks/864-8d9b6481be2de97f.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":4244,\"chunks\":[\"929:static/chunks/929-b3b28e896e4a9fe7.js\",\"185:static/chunks/app/layout-082a41cb7a9cbffe.js\"],\"name\":\"\","])</script><script>self.__next_f.push([1,"\"async\":false}\nc:I{\"id\":4724,\"chunks\":[\"929:static/chunks/929-b3b28e896e4a9fe7.js\",\"411:static/chunks/app/page/[page]/page-084fd1726e5b064b.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":6964,\"chunks\":[\"929:static/chunks/929-b3b28e896e4a9fe7.js\",\"185:static/chunks/app/layout-082a41cb7a9cbffe.js\"],\"name\":\"Image\",\"async\":false}\ne:I{\"id\":1443,\"chunks\":[\"272:static/chunks/webpack-5497ae65bf9d345f.js\",\"971:static/chunks/fd9d1056-23f6e37ad1d1612c.js\",\"864:static/chunks/864-8d9b6481be2de97f.js\"],\"name\":\"\",\"async\":false}\nf"])</script><script>self.__next_f.push([1,":I{\"id\":8639,\"chunks\":[\"272:static/chunks/webpack-5497ae65bf9d345f.js\",\"971:static/chunks/fd9d1056-23f6e37ad1d1612c.js\",\"864:static/chunks/864-8d9b6481be2de97f.js\"],\"name\":\"\",\"async\":false}\n11:I{\"id\":7259,\"chunks\":[\"929:static/chunks/929-b3b28e896e4a9fe7.js\",\"411:static/chunks/app/page/[page]/page-084fd1726e5b064b.js\"],\"name\":\"\",\"async\":false}\n12:T2f94,"])</script><script>self.__next_f.push([1,"\n## 웹팩(기본)배경\n- 웹팩은 모던 javascript 어플리케이션을 위한 정적 모듈 번들러이다. 번들러는 웹팩 이외에도 다양한게 있는데 (rollup , esbuild , vite , parcel 등) 웹팩이 가장 오래되었기도하고 많이 사용하고 있기 때문에 이번 기회에 배워보기로 했다.\n\n- Javascript에서 문법 수준에서 모듈을 지원하기 시작한것은 ES2015부터 이다. import/export 구문이 없었던 이전 상황에서는 하나의 함수를 만들었을 때 전역 공간에 노출되어 버그나 오류를 발생시킬 수 있었다.\n\n예를들어 아래와 같은 덧셈 함수는\n\n```javascript\n// math.js\nfunction add(a,b){\n    return a+b;\n}\n```\n\n```javascript\n// app.js\nadd(10,20);\n```\n\n모두 하나의 HTML 파일안에서 로딩해야만 실행된다. math.js가 로딩되면 app.js는 add 함수를 찾고 실행시키는데, add 함수가 전역으로 사용되기 때문에 다른 파일에서 같은 이름의 함수를 사용하면 충돌이 발생할 수 있다.\n\n---\n\n이런 문제를 예방하기위해 IIFE(즉시실행함수) 방식의 스코프를 사용했다.\n\n```javascript\nvar math = math || {}\n\n;(function () {\n  function add(a, b) {\n    return a + b\n  }\n  math.add = add\n})();\n```\n\n함수 스코프를 만들어 외부에서 접근할 수 없도록해 충돌을 막을 수 있었고, 전역에 선언한 math라는 이름만 사용하면 된다.\n\n---\n\n자바스크립트 모듈을 구현하는 대표적인 명세는 AMD와 CommonJS가 있다.\n\n- AMD(Asynchronous Module Definition)는 비동기 방식으로 모듈을 로딩한다. 브라우저 환경에서 주로 사용된다.\n- UMD(Universal Module Definition)는 AMD와 CommonJS를 지원하는 모듈을 만들기 위해 사용된다.\n- CommonJS는 export로 모듈을 만들고 require()함수로 import하는 방식이다. 주로 서버 사이드 플랫폼인 Node.js 환경에서 주로 사용된다.\n\n### CommonJS\n```javascript\n//math.js\nexport function add(a,b){\n    return a+b;\n}\n```\n\n```javascript\n//app.js\nconst math = require('./math.js');\nmath.add(10,20);\n```\n\n### ES2015 표준 모듈 시스템\n```javascript\n//math.js\nexport function add(a,b){\n    return a+b;\n}\n```\n\n```javascript\n//app.js\nimport {add} from './math.js';\nadd(10,20);\n```\n`export` 구문으로 모듈을 만들고 `import` 구문으로 가져올 수 있다.\n\n이러한 방식은 모든 브라우저에서 지원하지 않는다. 따라서 웹팩과 같은 모듈 번들러를 사용해야한다.\n\n---\n\n## 웹팩사용방법\n웹팩은 여러개의 파일을 하나로 합쳐주는 번들러(bundler)이다. 웹팩을 사용하면 자바스크립트뿐만 아니라 css, html, 이미지 등 모든 파일을 모듈로 관리할 수 있다.\n\n웹팩으로 간단하게 작업을 해보자.\n\n먼저 웹팩과 웹팩 터미널 도구인 cli를 설치한다.\n\n```shell\nnpm install -D webpack webpack-cli\n```\n\nroot 디렉토리에 `webpack.config.js` 파일을 생성한다.\n\n```javascript\n//webpack.config.js\nconst path = require('path');\n\nmodule.exports = {\n    mode: 'development',\n    entry: './src/index.js',\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, './dist'),\n    },\n};\n```\n\n- `mode`는 웹팩의 모드를 설정한다. `development`로 설정하면 개발용으로, `production`으로 설정하면 배포용으로 빌드된다.\n- `entry`는 웹팩이 빌드할 파일인 진입점을 지정한다.\n- `output`은 웹팩이 빌드한 결과물을 저장할 경로와 파일명을 지정한다.\n    - [name]은 entry에 지정한 파일명을 그대로 사용한다.\n    - [hash]는 웹팩이 빌드할 때마다 고유한 해시값을 붙여준다.\n\npackage.json에 빌드 스크립트를 추가한다.\n\n```json\n//package.json\n{\n    \"scripts\": {\n        \"build\": \"webpack\"\n    }\n}\n```\n\n이제 `npm run build` 명령어를 실행하면 웹팩이 빌드를 시작한다.\n\n---\n\n## 웹팩 로더\n웹팩은 자바스크립트 파일 뿐만 아니라 css, html, 이미지 등 모든 파일을 모듈로 관리할 수 있다.\n하지만 웹팩은 자바스크립트 파일만 이해할 수 있기 때문에 css나 html, 이미지 파일을 자바스크립트 파일로 변경해야한다. 이때 사용하는 것이 로더이다.\n\n자주 사용하는 로더\n- css-loader : css 파일을 자바스크립트 파일로 변경한다.\n- style-loader : 자바스크립트로 변경된 스타일을 동적으로 돔에 추가해준다. 주로 css-loader와 함께 사용한다.\n- file-loader : 파일을 모듈로 사용할 수 있게 url 경로를 변경한다.\n- url-loader : 파일을 모듈로 사용할 수 있게 url 경로를 변경하고 파일을 base64로 인코딩한다.\n\n### css-loader\n```shell\nnpm install -D css-loader\n```\n\n웹팩은 모두 모듈로 바라보기 때문에 자바스크립트 뿐만 아니라 스타일시트도 import 구문으로 불러올 수 있다.\n\n```javascript\nimport './style.css';\n```\n\n```css\n// style.css\nbody {\n    background-color: red;\n}\n```\n\n```javascript\n//webpack.config.js\nmodule.exports = {\n    {...}\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // .css 확장자로 끝나는 모든 파일\n        use: [\"css-loader\"], // css-loader를 적용한다\n      },\n    ],\n  },\n};\n```\n웹팩은 entry에서 모듈을 검색하다가 css 파일을 찾으면 css-loader를 적용한다.\n\n---\n\n### style-loader\n모듈로 변경된 스타일 시트는 돔에 추가되어야 브라우저가 해석한다.\ncss-loader는 css 파일을 자바스크립트 파일로 변경할 뿐 돔에 추가하지는 않는다. 따라서 style-loader를 추가해야한다.\n```shell\nnpm install -D style-loader\n```\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/,\n        use: [\"style-loader\", \"css-loader\"],\n      },\n    ],\n  },\n};\n```\nstyle-loader를 css-loader보다 앞에 적용한다. 로더는 배열로 설정하면 뒤 -\u003e 앞 순서대로 로더가 작동한다.\n\n---\n\n### file-loader\ncss 뿐만 아니라 소스코드에서 사용하는 모든 파일들을 모듈로 사용할 수 있게 할 수 있다.\n\n```shell\nnpm install -D file-loader\n```\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(png|jpe?g|gif)$/i, // i는 대소문자 구분없이, 확장자들\n        loader: \"file-loader\",\n        options: {\n          publicPath: \"./dist/\", // prefix를 아웃풋 경로로 지정\n          name: \"[name].[ext]?[hash]\", // 파일명 형식\n        },\n      },\n    ],\n  },\n};\n```\n옵션으로 경로를 지정할 수 있다. `publicPath`는 파일을 참조하는 경로를 지정한다. `name`은 파일명 형식을 지정한다.\n\n---\n\n### url-loader\n파일을 base64로 인코딩하여 문자열 형태로 변환한다. 파일 크기가 작은 파일들은 문자열로 변환하여 파일을 요청하는 횟수를 줄일 수 있다.\n\n```shell\nnpm install -D url-loader\n```\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(png|jpe?g|gif)$/i,\n        loader: \"url-loader\",\n        options: {\n          publicPath: \"./dist/\",\n          name: \"[name].[ext]?[hash]\",\n          limit: 5000, // 5kb 미만 파일만 data url로 처리\n        },\n      },\n    ],\n  },\n};\n```\n\n---\n\nfile-loader와 url-loader는 v5부터 기본적으로 제공하며, `asset`이라는 키워드로 사용할 수 있다.\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(png|jpe?g|gif)$/i,\n        type: \"asset/resource\", // file-loader\n        generator: {\n          filename: \"[name][ext]?[hash]\", // [name]은 파일명, [ext]는 확장자\n        },\n      },\n      {\n        test: /\\.(png|jpe?g|gif)$/i,\n        type: \"asset/inline\", // url-loader\n        generator: {\n          filename: \"[name][ext]?[hash]\",\n        },\n      },\n      {\n        test: /\\.(png|jpe?g|gif)$/i,\n        type: \"asset\", // 기본값은 8kb 미만은 inline, 8kb 이상은 resource\n        generator: {\n          filename: \"[name][ext]?[hash]\",\n        },\n      },\n    ],\n  },\n};\n```\n\n---\n\n## 웹팩 플러그인\n로더는 파일을 해석하고 변환하는 과정에 관여하지만 플러그인은 해당 결과물의 형태를 바꾸는 역할을 한다. 로더는 파일 단위로 처리하는 반면 플러그인은 번들된 결과물을 처리한다.\n번들된 자바스크립트를 난독화 한다거나, 특정 텍스트를 추출할 수 있는 용도로 사용한다.\n\n자주 사용하는 플러그인\n- BannerPlugin : 결과물에 빌드 정보나 버전같은 정보를 추가할 수 있다.\n- DefinePlugin : 환경변수를 설정한다.\n- HtmlWebpackPlugin : HTML 파일을 후처리한다.\n- CleanWebpackPlugin : 이전 빌드 결과물을 제거한다.\n- MiniCssExtractPlugin : CSS 파일을 별도로 추출한다.\n\n---\n\n### BannerPlugin\n```javascript\nconst webpack = require(\"webpack\");\n\nmodule.exports = {\n  plugins: [\n    new webpack.BannerPlugin({\n      banner: () =\u003e `빌드 날짜: ${new Date().toLocaleString()}`,\n    }),\n  ],\n};\n```\n\n---\n\n### DefinePlugin\n개발환경과 운영환경으로 나누어서 작업할 때 환경변수를 설정할 수 있다.\n환경에 의존적인 정보를 소스가 아닌 환경 변수로 관리하면 소스코드를 더욱 안전하고 편리하게 관리할 수 있다.\n\n```javascript\nconst webpack = require(\"webpack\");\n\nmodule.exports = {\n  plugins: [\n    new webpack.DefinePlugin({\n      VERSION: JSON.stringify(\"v.1.2.3\"),\n      PRODUCTION: JSON.stringify(false),\n      MAX_COUNT: JSON.stringify(999),\n      \"api.domain\": JSON.stringify(\"http://dev.api.domain.com\"),\n    }),\n  ],\n};\n```\n\n---\n\n### HtmlWebpackPlugin\n```shell\nnpm install -D html-webpack-plugin\n```\n\n```javascript\nconst HtmlWebpackPlugin = require(\"html-webpack-plugin\");\n\nmodule.exports = {\n  entry: 'index.js',\n  output: {\n    path: path.resolve(__dirname, './dist'),\n    filename: 'index_bundle.js',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: \"./src/index.html\", // 템플릿 경로를 지정\n      minify:\n        process.env.NODE_ENV === \"production\"\n          ? {\n              // 빌드 모드가 production일 때만 사용\n              collapseWhitespace: true, // 빈칸 제거\n              removeComments: true, // 주석 제거\n            }\n          : false,\n    }),\n  ],\n};\n```\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003ctitle\u003ewebpack App\u003c/title\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cscript src=\"index_bundle.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\nscript 태그에 번들링된 결과물을 자동으로 추가해준다. 웹팩 엔트리가 여러개일 경우 여러개의 script 태그를 추가해준다.\n\n---\n\n### CleanWebpackPlugin\n```shell\nnpm install -D clean-webpack-plugin\n```\n\n```javascript\nconst { CleanWebpackPlugin } = require(\"clean-webpack-plugin\");\n\nmodule.exports = {\n  plugins: [new CleanWebpackPlugin()],\n};\n```\n\n---\n\n### MiniCssExtractPlugin\n스타일 시트가 점점 많아짐에 따라 하나의 자바스크립트로 만들면 부담이 될 수 있다.\n번들 결과물에서 스타일시트 코드만 따로 분리하여 별도의 css파일로 만들어주는 플러그인이다.\n\n```shell\nnpm install -D mini-css-extract-plugin\n```\n\n```javascript\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/,\n        use: [MiniCssExtractPlugin.loader, \"css-loader\"],\n      },\n    ],\n  },\n  plugins: [\n    new MiniCssExtractPlugin({\n      filename: \"[name].css\",\n    }),\n  ],\n};\n```\n\n운영 환경에서는 `MiniCssExtractPlugin.loader`를 사용해 스타일시트를 별도의 파일로 분리한다. 개발 환경에서는 `style-loader`를 사용해 동적으로 돔에 추가한다.\n\n---\n\n웹팩의 로더와 플러그인의 원리, 사용방법에 대해서 알아보았다.\n\n우리가 편리하고 쉽게 사용하는 Create-React-App는 웹팩으로 빌드된 결과물을 제공해준다.\n하지만 기본적인 웹팩으로 설정되어있고, 직접 커스텀하려면 eject를 해야한다.\n\n이번 기회에 웹팩의 원리와 기본적인 사용방법을 알아보았다.\n"])</script><script>self.__next_f.push([1,"13:Te9a,"])</script><script>self.__next_f.push([1,"\n### React Native geolocation\n\n사이드 프로젝트에 위치정보를 받아와야 하는 기능이 필요해 지오로케이션을 받아 오도록 했다.\n\n### 설치\n\nhttps://www.npmjs.com/package/react-native-geolocation-service\n\n```bash\nyarn add react-native-geolocation-service\n```\n\n---\n\n### IOS\n- 먼저 xcode를 열고 swift 파일을 생성해준다.\n\n\u003cdiv style={{ display: \"flex\", gap: '10px' }}\u003e\n    \u003cimg src=\"/assets/blog/javaScript/rn-geolocation.png\" width=\"49%\" style={{ maxWidth: '40%'}} alt=\"post image\"/\u003e\n    \u003cimg src=\"/assets/blog/javaScript/rn-geolocation-2.png\" width=\"49%\" style={{ maxWidth: '59%'}} alt=\"post image\"/\u003e\n\u003c/div\u003e\n\n프로젝트 폴더에 swift 파일을 생성해주고 Create Bridging Header 를 선택해준다.\n\n---\n\n- 디바이스에서 위치정보를 받아오려면 권한 설정이 필요하다.\n\n```\n// ios/[projectName]/info.plist\n\n\u003ckey\u003eNSLocationAlwaysAndWhenInUseUsageDescription\u003c/key\u003e\n\u003cstring\u003e서비스를 제공하는 업체 위치를 확인을 위한 위치기반 정보 서비스를 이용할 수 있습니다.\u003c/string\u003e\n\u003ckey\u003eNSLocationAlwaysUsageDescription\u003c/key\u003e\n\u003cstring\u003e서비스를 제공하는 업체 위치를 확인을 위한 위치기반 정보 서비스를 이용할 수 있습니다.\u003c/string\u003e\n\u003ckey\u003eNSLocationWhenInUseUsageDescription\u003c/key\u003e\n\u003cstring\u003e서비스를 제공하는 업체 위치를 확인을 위한 위치기반 정보 서비스를 이용할 수 있습니다.\u003c/string\u003e\n```\n\n---\n\n\u003cdiv style={{ display: \"flex\", gap: '10px' }}\u003e\n    \u003cimg src=\"/assets/blog/javaScript/rn-geolocation-3.png\" width=\"49%\" style={{ maxWidth: '40%'}} alt=\"post image\"/\u003e\n    \u003cimg src=\"/assets/blog/javaScript/rn-geolocation-4.png\" width=\"49%\" style={{ maxWidth: '59%'}} alt=\"post image\"/\u003e\n\u003c/div\u003e\n\n- 백그라운드에서도 위치정보를 가져오려면 워크스페이스에서 위와 같이 Location updates에 체크해 설정한다.\n\n---\n\n### Android\n\n- 안드로이드도 마찬가지로 권한 설정이 필요하다.\n\n```xml\n// android/app/src/main/AndroidManifest.xml\n\n\u003cuses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" /\u003e\n\u003cuses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" /\u003e\n```\n\n---\n\n### 사용법\n\n```tsx\n  useEffect(() =\u003e {\n    if (Platform.OS === 'ios') {\n      Geolocation.requestAuthorization('always');\n    } else {\n      PermissionsAndroid.requestMultiple([\n        PermissionsAndroid.PERMISSIONS.ACCESS_COARSE_LOCATION,\n        PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,\n      ]);\n    }\n  }, []);\n```\n\n- requestAuthorization로 위치정보 권한을 요청합니다.\n\n---\n\n### 가장 많이 쓰이는 세가지 API\n\n- getCurrentPosition(successCallback, ?errorCallback, ?options) - 최신 위치정보 호출 (한번)\n- watchPosition(successCallback, ?errorCallback, ?options) - 지속적으로 호출\n- clearWatch(watchId)\n\n```tsx\nimport Geolocation from 'react-native-geolocation-service';\n\nconst MyApp = () =\u003e {\n    const [location, setLocation] = useState\u003cILocation | undefined\u003e(undefined);\n\n    useEffect(() =\u003e {\n        const _watchId = Geolocation.watchPosition(\n          position =\u003e {\n            const {latitude, longitude} = position.coords;\n            setLocation({latitude, longitude});\n          },\n          error =\u003e {\n            console.log(error);\n          },\n          {\n            enableHighAccuracy: true,\n            distanceFilter: 0,\n            interval: 5000,\n            fastestInterval: 2000,\n          },\n        );\n\n        return () =\u003e {\n          if (_watchId) {\n            Geolocation.clearWatch(_watchId);\n          }\n        };\n      }, []);\n\n    return \u003c\u003e\u003c/\u003e;\n}\n\n```\n\n다음 포스팅에서는 받아온 위치정보를 webview로 넘겨주는 방법에 대해 알아보자!\n\n\n"])</script><script>self.__next_f.push([1,"14:T9c4,"])</script><script>self.__next_f.push([1,"\n### 딥링크\n- 딥링크는 모바일에서 특정 페이지에 도달 할 수 있는 링크를 의미한다.\n- 웹이나 sns등 링크를 클릭했을때 해당 어플리케이션 앱으로 바로 이동하는데, 이런 방식을 모바일 딥링크라 하고 특정한 앱 스크린으로 이동하는 것\n\n- 딥링크는 URL 스킴, https://, 두가지 형태를 지원한다.\n- ex) `app://example.my.app`, `https://www.example.com`\n\n```shell\nyarn add @react-native-firebase/dynamic-links\n```\n\n```jsx\nimport { Linking } from 'react-native';\nimport dynamicLinks from '@react-native-firebase/dynamic-links';\n```\n\n\n### ios\n\nios \u003e [프로젝트] \u003e AppDelegate.mm\n\n```swift\n#import \u003cReact/RCTLinkingManager.h\u003e\n\n{...}\n\n- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url options:(NSDictionary\u003cUIApplicationOpenURLOptionsKey,id\u003e *)options {\n  return [RCTLinkingManager application:application openURL:url options:options];\n}\n```\n\nxcode로 가 Identifier 프로젝트에 Bundle ID를 넣고,\nURL Schemes에 프로토콜을 정의한다.\n\n### android\n\nandroid \u003e app \u003e src \u003e main \u003e AndroidManifest.xml\n\n```xml\n  \u003cintent-filter\u003e\n    \u003caction android:name=\"android.intent.action.MAIN\" /\u003e\n    \u003ccategory android:name=\"android.intent.category.LAUNCHER\" /\u003e\n  \u003c/intent-filter\u003e\n\n  \u003cintent-filter\u003e\n    \u003caction android:name=\"android.intent.action.VIEW\" /\u003e\n    \u003ccategory android:name=\"android.intent.category.DEFAULT\" /\u003e\n    \u003ccategory android:name=\"android.intent.category.BROWSABLE\" /\u003e\n    \u003cdata\n      android:host=\"example.com\"\n      android:pathPrefix=\"/\"\n      android:scheme=\"https\" /\u003e\n  \u003c/intent-filter\u003e\n```\n\n\n### URL 처리\n\n```jsx\nconst handleDynamicLink = async () =\u003e {\n  const initialLink = await dynamicLinks().getInitialLink();\n  if (initialLink) {\n    console.log('initialLink', initialLink);\n  }\n};\n\nuseEffect(() =\u003e {\n  handleDynamicLink();\n}, []);\n```\n\n### WebView 이슈\n\n앱이 죽어있는 상태로 외부에서 딥링크를 클릭했을 때 앱이 켜지고 해당 페이지로 이동하는데, 이때 WebView가 렌더링 되지 않는 이슈가 있다.\n\n```jsx\n// 앱이 처음 시작시 초기화\nuseEffect(() =\u003e {\n  const getInitURL = async () =\u003e {\n    const initURL = await Linking.getInitialURL();\n    if (initURL) {\n      ...process\n    }\n  };\n  getInitURL();\n}, []);\n\n// 앱이 열려있는 상태\nuseEffect(() =\u003e {\n  Linking.addEventListener('url', e =\u003e {\n      if(e.url){\n          ...process\n      }\n  });\n  return () =\u003e Linking.removeAllListeners('url');\n}, [])\n```\n"])</script><script>self.__next_f.push([1,"15:T2147,"])</script><script>self.__next_f.push([1,"\n이전에 [스벨트킷으로 블로그 만들어보기](https://wonbeenna.github.io/blog/javaScript/svelte-blog) 에서 svelte kit으로 블로그를 만들었었다.\n\n그때는 svelte 공부겸 블로그를 만들었지만, 업무에서 주로 사용하는 스택인 react와 next.js를 사용하여 블로그를 만들어보려고 한다.\n\n### 시작\n---\n```shell\nnpx create-next-app \u003cproject-name\u003e\n```\n\nnext.js 프로젝트를 생성한다.\n\n### 라우팅\n---\n\u003cimg src=\"/assets/blog/javaScript/route.png\" style={{\n    maxWidth: \"300px\",\n    height: \"auto\"\n}} alt=\"next-blog-route\" /\u003e\n\napp 폴더 구조는 위와 같다.\n\n- root layout을 만들어 Header, Footer를 구성한다.\n- page/[page]는 블로그의 메인이며 페이지네이션을 위해 동적으로 구성하였다.\n- blog/[category]/[slug]는 카테고리별로 블로그를 구분하고, slug를 통해 각 post를 구분한다.\n\n### 블로그 포스트\n\nroot layout을 만들었으니, 이제 블로그 포스트를 만들어보자.\n\nroot 디렉토리에 _posts폴더를 만들고 그 안에 markdown 파일을 만든다.\n\n\n```shell\nnpm install gray-matter\n```\n\ngray-matter는 markdown 파일의 front matter를 파싱하는 라이브러리이다.\n\n```ts\nimport path from 'path';\nimport * as fs from 'fs';\nimport matter from 'gray-matter';\nimport { getSerialize } from '@/utils/sirialize';\n\nexport const POSTS_PATH = path.join(process.cwd(), '_posts');\n\nexport const postFilePaths = fs.readdirSync(POSTS_PATH).filter((path) =\u003e /\\.mdx?$/.test(path));\n\nexport const getAllPost = (\n  category?: string,\n  paging: { page: string; limit?: string } = {\n    page: '1',\n    limit: '10'\n  }\n) =\u003e {\n  let total = postFilePaths.length;\n  let posts = postFilePaths\n    .map((filePath) =\u003e {\n      const source = fs.readFileSync(path.join(POSTS_PATH, filePath));\n      const { content, data } = matter(source);\n      const slug = filePath.replace(/\\.mdx?$/, '');\n\n      return {\n        content,\n        data,\n        slug\n      };\n    })\n    .sort((a, b) =\u003e {\n      return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();\n    });\n\n  if (category) {\n    posts = posts.filter((post) =\u003e post.data.category === category);\n    total = posts.length;\n  }\n\n  if (!paging.page) {\n    paging.page = '1';\n    paging.limit = '10';\n  }\n\n  if (paging.limit === '-1') {\n    return {\n      posts,\n      total\n    };\n  }\n\n  const { page = '1', limit = '10' } = paging;\n  const offset = (+page - 1) * +limit;\n\n  posts = posts.slice(offset, offset + +limit);\n\n  return {\n    posts,\n    total\n  };\n};\n```\n\nfile path를 통해 _posts폴더 내 markdown 파일을 읽어오고, gray-matter를 통해 front matter를 파싱한다.\n\n메인과 blog 페이지를 구성하기위해 getAllPost 함수를 만들었고, 각각의 블로그들은 getPost 함수를 통해 가져온다.\n\n```ts\nexport const getPost = async (slug: string) =\u003e {\n  const allPost = getAllPost(undefined, {\n    page: '1',\n    limit: '-1'\n  });\n\n  const index = allPost.posts.findIndex((post) =\u003e post.slug === slug);\n  const prevPost = allPost.posts[index + 1];\n  const nextPost = allPost.posts[index - 1];\n\n  const source = fs.readFileSync(path.join(POSTS_PATH, `${slug}.mdx`));\n\n  const { content, data } = matter(source);\n  const mdx = await getSerialize(content, data);\n\n  return {\n    mdx,\n    content,\n    data,\n    slug,\n    prevPost: {\n      slug: prevPost?.slug,\n      title: prevPost?.data.title,\n      category: prevPost?.data.category\n    },\n    nextPost: {\n      slug: nextPost?.slug,\n      title: nextPost?.data.title,\n      category: nextPost?.data.category\n    }\n  };\n};\n```\n\n```shell\nnpm i next-mdx-remote\n```\n\nnext-mdx-remote는 mdx 파일을 html로 변환해주는 라이브러리이다.\n\n위 코드에서 getSerialize 함수는 mdx 파일을 html로 변환해주는 함수이다.\n\nhtml로 변환하는데 있어 remark와 rehype를 사용할 수 있다.\n\n```ts\nimport { serialize } from 'next-mdx-remote/serialize';\nimport remarkGfm from 'remark-gfm';\nimport rehypePrism from 'rehype-prism-plus';\n\nexport const getSerialize = async (content: string, data: any) =\u003e {\n  return await serialize(content, {\n    mdxOptions: {\n      remarkPlugins: [remarkGfm],\n      rehypePlugins: [rehypePrism]\n    },\n    scope: data\n  });\n};\n```\n\n```tsx\n\u003cMDXRemote {...source} components={components} /\u003e\n```\n\n위에서 변환된 html을 MDXRemote 컴포넌트를 통해 렌더링한다.\n\n### 카테고리\n---\n\n카테고리 별로 필터하기위해 카테고리도 따로 받아와야 했다.\n각각의 post들을 읽고 중복되지 않은 카테고리들만 가져오는 함수를 만들었다.\n\n```ts\nimport { getAllPost } from '@/utils/getPost';\n\nexport const getCategories = (): {\n  title: string;\n  count: number;\n}[] =\u003e {\n  const posts = getAllPost(undefined, { page: '1', limit: '-1' });\n\n  let uniqueCategories: any = {};\n\n  posts.posts.forEach((post) =\u003e {\n    if (uniqueCategories.hasOwnProperty(post.data.category)) {\n      uniqueCategories[post.data.category].count += 1;\n    } else {\n      uniqueCategories[post.data.category] = {\n        title: post.data.category,\n        count: 1\n      };\n    }\n  });\n\n  return Object.values(uniqueCategories).sort((a, b) =\u003e a.title \u003e b.title);\n};\n\n```\n\n### 페이지\n---\n위에서 구성한 함수들을 페이지에서 사용해보자.\n\n```tsx\nexport const generateStaticParams = async () =\u003e {\n  const posts = getAllPost(undefined, {\n    page: '1',\n    limit: '-1'\n  });\n\n  return Array.from({ length: Math.ceil(posts.total / 10) }, (_, i) =\u003e {\n    return {\n      page: (i + 1).toString()\n    };\n  });\n};\n\nconst Page = ({ params }: { params: { page: string } }) =\u003e {\n  return \u003cPostListContainer page={params.page} /\u003e;\n};\n\nexport default Page;\n```\n\n```tsx\n// blog/[category]/[slug].tsx\nexport const generateStaticParams = async () =\u003e {\n  const posts = getAllPost(undefined, {\n    page: '1',\n    limit: '-1'\n  });\n\n  return posts.posts.map((post) =\u003e {\n    return {\n      slug: post.slug,\n      category: post.data.category\n    };\n  });\n};\n```\n\napp 라우트에서 SSG를 사용하기 위해 generateStaticParams 함수가 필요했다.\nPostListContainer 컴포넌트를 통해 각 page들을 렌더링 하였고, generateStaticParams 함수를 통해 페이지네이션을 위한 params들을 생성하였다.\n\n### SEO\n---\n\nseo를 위해 meta 태그와 sitemap, robots를 생성했다.\n\nnext 13 에서는 간단하게 위 세가지를 구성할 수 있었다.\n\n먼저 sitemap.ts를 app 폴더에 만들고\n\n```ts\nimport { getAllPost } from '@/utils/getPost';\nimport { MetadataRoute } from 'next';\n\nconst defaultUrl = process.env.NEXT_PUBLIC_BASE_URL;\nconst pageRoutes = [`${defaultUrl}`, `${defaultUrl}/blog`, `${defaultUrl}/about`];\n\nexport default function sitemap(): MetadataRoute.Sitemap {\n  const posts = getAllPost(undefined, {\n    page: '1',\n    limit: '-1'\n  });\n\n  const defaultRoutes: MetadataRoute.Sitemap = pageRoutes.map((route) =\u003e {\n    return {\n      url: route,\n      lastModified: new Date().toISOString(),\n      changeFrequency: 'weekly',\n      priority: 1\n    };\n  });\n\n  const postRoutes: MetadataRoute.Sitemap = posts.posts.map((post) =\u003e {\n    return {\n      url: `${defaultUrl}/blog/${post.data.category}/${post.slug}`,\n      lastModified: new Date(post.data.date).toISOString(),\n      changeFrequency: 'weekly',\n      priority: 1\n    };\n  });\n\n  return [...defaultRoutes, ...postRoutes];\n}\n```\n처럼 함수를 만들면 sitemap이 생성된다.\n\nrobots도 마찬가지로 app 폴더에 robots.ts를 만들고\n\n```ts\nimport { MetadataRoute } from 'next';\n\nexport default function robots(): MetadataRoute.Robots {\n  return {\n    rules: {\n      userAgent: '*',\n      allow: '/'\n    },\n    sitemap: 'https://wonbeenna.github.io/sitemap.xml'\n  };\n}\n```\n\n위와 같이 작성하면 된다.\n\nmetadata는 각 페이지에서 generateMetadata 함수를 통해 생성하면 된다.\n\n```ts\nexport const generateMetadata = async ({ params }: { params: { page: string } }) =\u003e {\n  return {\n    title: `Been blog - ${params.page}`,\n    openGraph: {\n      ...defaultOpenGraph,\n      title: `Been blog - ${params.page}`,\n      description: `Been dev-note - ${params.page}`,\n      url: `${process.env.NEXT_PUBLIC_BASE_URL}/page/${params.page}`\n    }\n  };\n};\n```\n\n### 댓글\n---\n\n댓글은 giscus를 사용했다.\n\ngiscus는 github Discussions으로 댓글로 사용할 수 있게 해주는 라이브러리이다.\n\n```shell\nnpm i @giscus/react\n```\n\n[giscus](https://giscus.app/ko)\n\n위 문서에 쉽게 설명되어 있으니 생략!\n\n\n\n\n\n"])</script><script>self.__next_f.push([1,"16:T6ae,"])</script><script>self.__next_f.push([1,"\nJSON 웹 토큰(JWT)\n\n일반적으로 **헤더.페이로드.서명** 으로 구성되어 있다.\n\n1.헤더 - 어떤 알고리즘으로 암호화 할것인지\n\n2.데이터 - 전달하려는 정보, 사용자의 id, name 등\n\n3\\. 서명 - 서버가 지정한 secret key로 암호화 시켜 토큰을 변조하기 어렵게 만듬\n\n이 세 부분을 Base64url로 인코딩해 \n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbkFzIjoiYWRtaW4iLCJpYXQiOjE0MjI3Nzk2Mzh9.gzSraSYS8EXBxLN_oWnFSRgCzcmJmMjLiuyu5CSpyHI\n```\n\n위와 같은 형태로 파싱해 사용한다.\n\njwt 데이터 부분에서 정보를 가져와 사용할 수 있는데, decoding 해주어야 한다.\n\n```javascript\nexport const decodeJwtResponse = (token: string) =\u003e {\n  let base64Url = token.split('.')[1]\n  let base64 = base64Url?.replace(/-/g, '+')?.replace(/_/g, '/')\n  let jsonPayload = decodeURIComponent(\n    atob(base64)\n      .split('')\n      .map(function (c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)\n      })\n      .join('')\n  )\n\n  return JSON.parse(jsonPayload)\n  let base64Payload = token.split('.')[1]\n\n  let payload = Buffer.from(base64Payload, 'base64')\n  return JSON.parse(payload.toString())\n}\n```\n\natob 함수는 node에서 더이상 지원하지 않아 아래로 수정\n\n```javascript\nexport const decodeJwtResponse = (token: string) =\u003e {\n  let base64Payload = token.split('.')[1]\n\n  let payload = Buffer.from(base64Payload, 'base64')\n\n  return JSON.parse(payload.toString())\n}\n```\n\ntoken을 split해 1번째 데이터에 해당하는 부분을 가져온 다음\n\nnode에서 지원하는 Buffer 객체를 사용해 바이너리로 변환\n\nbase64로 인코딩한 후 JSON으로 파싱한다\n"])</script><script>self.__next_f.push([1,"17:Tfb3,"])</script><script>self.__next_f.push([1,"\n얼마전 기업과제를 진행했다. Audio 객체를 이용한 음악 재생이었다.\n\nhttps://developer.mozilla.org/ko/docs/Web/API/Web_Audio_API/Using_Web_Audio_API\n\n## Audio 객체\n웹에서 음악을 재생하기 위해서는 new Audio 객체를 생성하거나, `\u003caudio\u003e` 태그를 사용해 Audio 객체를 가져올 수도 있다.\n\nAudio 객체는 음악을 재생하고, 일시정지하고, 음악의 길이를 구하는 등의 기능을 제공한다.\n\nAudio 객체는 다음과 같이 생성한다.\n\n```jsx\nlet audio = new Audio(url);\n```\n\n```jsx\n\u003caudio src={url} /\u003e;\n```\n\n과제를 제출하고 알게 되었는데, new Audio 객체를 사용하면 화면 밖에서도 audio를 다룰 수 있기때문에 `audio`태그를 사용할 필요가 없었다.\n\n둘중 하나만 사용해 Audio를 다룰 수 있는 객체를 가져오면 된다.\n\n```javascript\nlet audio = document.querySelector('audio');\naudio.play();\naudio.pause();\n```\n\n과제에서는 new Audio를 사용해 구현 하였다.\n```jsx\n  useEffect(() =\u003e {\n    setAudio(new Audio(url));\n}, [url, setAudio]);\n```\n먼저 server에서 받아온 Url을 state에 담아 주었고\n\n```jsx\n  useEffect(() =\u003e {\n    if (audio \u0026\u0026 isPlaying) {\n        audio?.play();\n    }\n}, [audio, isPlaying]);\n```\n\n리스트에서 음악을 선택하면 `isPlaying`이 true가 되고, `audio`가 생성되면 `audio.play()`를 실행한다.\n\n재생과 일시정지도 추가가 되어야 했다.\n\n```jsx\nconst handlePlayButton = () =\u003e {\n    if (audio?.paused) {\n        return audio.play();\n    }\n    return audio?.pause();\n}\n```\n음악이 정지중일땐 play, 음악이 재생중일땐 pause를 실행한다.\n\n---\n\n음악이 재샐중일때 progress bar도 구현이 필요했다.\n\n```jsx\nconst [rangeValue, setRange] = useState\u003cnumber\u003e(0);\nconst [currentTime, setCurrentTime] = useState\u003cstring\u003e('00:00');\nconst [duration, setDuration] = useState\u003cstring\u003e('00:00');\n\n\u003cprogress\n    className=\"progress\"\n    value={Math.floor(rangeValue)}\n    max=\"100\"\n    aria-valuemin={0}\n    aria-valuemax={100}\n    aria-valuenow={Math.floor(rangeValue)}\n    onClick={handleChangeProgressRange}\n/\u003e\n```\n\n`rangeValue`는 progress bar의 value값을 나타내고, `currentTime`는 현재 재생중인 시간을 나타낸다.\n\n`duration`는 음악의 전체 길이를 나타낸다.\n\n재생시간과 음악의 전체 길이가 `00:00`으로 표시되었어야했기 때문에 format함수를 만들었고, eventListener를 통해 재생시간과 음악의 전체 길이를 구했다.\n\n```js\nexport const getMusicTimeFormat = (time = 0) =\u003e {\n  let minutes = Math.floor((time % 3600) / 60)\n    .toString()\n    .padStart(2, '0');\n  let seconds = Math.floor(time % 60)\n    .toString()\n    .padStart(2, '0');\n\n  return minutes + ':' + seconds;\n};\n```\n```jsx\n  useEffect(() =\u003e {\n    audio?.addEventListener('timeupdate', () =\u003e {\n        setDuration(getMusicTimeFormat(audio.duration || 0));\n        setCurrentTime(getMusicTimeFormat(audio.currentTime));\n        setRange((audio?.currentTime / audio?.duration || 0) * 100);\n    });\n}, [audio]);\n````\n\n`timeupdate`이벤트는 음악이 재생중일때마다 발생한다.\n\n```js\n  const handleChangeProgressRange = (e: React.MouseEvent\u003cHTMLProgressElement\u003e) =\u003e {\n    if (audio) {\n        let clickPosition = e.pageX - e.currentTarget.offsetLeft;\n        let clickedValue = (clickPosition * e.currentTarget.max) / e.currentTarget.offsetWidth;\n        audio.currentTime = (parseInt(String(clickedValue), 10) / 100) * audio.duration;\n        setRange(parseInt(String(clickedValue), 10));\n    }\n};\n```\nprogressbar를 클릭했을 때는 해당 위치부터 audio를 재생해야했다.\n`clickPosition`은 progressbar를 클릭한 위치를 나타내고, `clickedValue`는 progressbar의 value값을 나타낸다.\n\n- e.pageX = 브라우저 상의 마우스 클릭 위치\n- e.currentTarget.offsetLeft = progressbar의 x축(왼쪽) 위치\n- e.currentTarget.max = progressbar의 최대값\n- e.currentTarget.offsetWidth = progressbar의 전체 너비\n\n\n"])</script><script>self.__next_f.push([1,"18:Te25,"])</script><script>self.__next_f.push([1,"\n### 디바운싱과 쓰로틀링\n\n\n- 디바운싱: 연속으로 호출되는 함수들 중 가장 마지막 함수(또는 제일 처음)만 호출하도록 하는 것\n- 쓰로틀링: 함수가 연속적으로 실행되는 경우 현재 실행되고 있는 함수가 없는 경우에만 함수를 실행함\n\n예를들어 검색을 요구하는 API에 \"test\"를 검색한다고 가정한 경우, 일반적인 경우에는 t, e, s, t 각 글자를 입력할 때 마다 API가 호출이 된다.\n\n이런 경우 불필요한 요청이 서버에 부담을 줄 수가 있다.\n\n이 때 디바운싱을 사용하게 된다면, 가장 마지막인 글자가 입력되고, 하나의 단어가 완성되었을때 API에 요청을 할 수 있다.\n\n쓰로틀링인 경우에는 t를 입력했을 때 API요청이 발생하고, 이후 일정 시간동안은 아무 응답도 받지 않는다.\n정해진 시간이 모두 지나고난 뒤에 마지막으로 입력된 글자까지 요청이 가게 된다.\n즉 실행 횟수에 제한을 거는 것이다.\n\n### 디바운싱\n```tsx\nimport { useEffect, useState } from 'react'\n\nfunction useDebounce\u003cT\u003e(value: T, delay?: number): T {\n  const [debouncedValue, setDebouncedValue] = useState\u003cT\u003e(value)\n\n  useEffect(() =\u003e {\n    const timer = setTimeout(() =\u003e setDebouncedValue(value), delay || 500)\n\n    return () =\u003e {\n      clearTimeout(timer)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\nexport default useDebounce\n```\n```js\nimport { ChangeEvent, useEffect, useState } from 'react'\nimport { useDebounce } from 'usehooks-ts'\n\nexport default function Component() {\n  const [value, setValue] = useState\u003cstring\u003e('')\n  const debouncedValue = useDebounce\u003cstring\u003e(value, 500)\n\n  const handleChange = (event: ChangeEvent\u003cHTMLInputElement\u003e) =\u003e {\n    setValue(event.target.value)\n  }\n\n  // Fetch API (optional)\n  useEffect(() =\u003e {\n    // Do fetch here...\n    // Triggers when \"debouncedValue\" changes\n  }, [debouncedValue])\n\n  return (\n    \u003cdiv\u003e\n      \u003cp\u003eValue real-time: {value}\u003c/p\u003e\n      \u003cp\u003eDebounced value: {debouncedValue}\u003c/p\u003e\n\n      \u003cinput type=\"text\" value={value} onChange={handleChange} /\u003e\n    \u003c/div\u003e\n  )\n}\n```\n출처: [react-hook](https://usehooks-ts.com/react-hook/use-debounce)\n\ninput feild에 값이 들어갈 때마다 onChange 이벤트가 트리거되고, hook으로 전달받은 value가 clearTimeout으로 초기화된 useEffect내부 setTimeout의 delay만큼 시간이 지난 후 debouncedValue로 return 된다.\n\n### 쓰로틀링\n```js\nimport { useEffect, useRef, useState } from 'react';\n\nconst useThrottle = (value, limit) =\u003e {\n    const [throttledValue, setThrottledValue] = useState(value);\n    const lastRan = useRef(Date.now());\n\n    useEffect(() =\u003e {\n        const handler = setTimeout(() =\u003e {\n            if (Date.now() - lastRan.current \u003e= limit) {\n                setThrottledValue(value);\n                lastRan.current = Date.now();\n            }\n        }, limit - (Date.now() - lastRan.current));\n\n        return () =\u003e {\n            clearTimeout(handler);\n        };\n    }, [value, limit]);\n\n    return throttledValue;\n};\n\nexport default useThrottle;\n```\n```js\nconst [value, setValue] = useState('');\n{...}\nconst throttleText = useThrottle(value, 1000);\n```\nhook이 실행되면 lastRan과 현재시간을 비교한다.\n\n만약 (Date.now() - lastRan.current) 즉, value가 입력된 시간이 limit보다 크다면 value를 throttledValue로 return하고, lastRan을 현재시간으로 초기화한다.\n\n만약 value가 입력된 시간이 limit보다 작다면 limit - value가 입력된 시간이 시간이 지난 후에 throttledValue로 return한다.\n\n\n\n\n"])</script><script>self.__next_f.push([1,"19:Tc4f,"])</script><script>self.__next_f.push([1,"\n## GraphQL 사용\n\nApollo client를 사용합니다.\n\nApollo Client는 GraphQL을 사용해 로컬 및 원격 데이터를 모두 관리할 수 있습니다. (상태 관리 라이브러리)\n\n---\n\n### React에 Apollo Client 연결\n```shell\nnpm install @apollo/client graphql\n```\n\nindex.ts 또는 App.ts 에서 작업을 진행합니다.\n```ts\nconst client = new ApolloClient({\n  uri: \"https://~/graphql\",\n  cache: new InMemoryCache(),\n});\n```\n\n다음과 같이 ApolloClient를 초기화 하고 `uri`와 `cache` 인스턴스를 전달합니다.\n\nuri에 서버주소를 작성합니다. endpoint를 따로 지정하지 않았다면 `/graphql`이 됩니다.\n\n사내에서는 `proxy`를 사용하기 때문에 `endpoint`를\n```ts\nconst client = new ApolloClient({\n  uri: '/api/graphql',\n  cache: new InMemoryCache()\n})\n```\n로 작성해주시면 됩니다.\n\n```ts\nfunction App() {\n  return (\n{...}\n        \u003cApolloProvider client={client}\u003e\n            \u003cDefaultRoutes /\u003e\n        \u003c/ApolloProvider\u003e\n{...}\n  )\n}\n```\nreact app에 전역으로 사용하기 위해서는 `ContextApi`를 사용하는 것 처럼 `ApolloProvider`로 앱을 감싸면 됩니다.\n\n---\n\n### 백엔드 데이터 읽기\n이제 `client`는 데이터를 가져올 준비가 되었습니다.\n\n\u003cimg src=\"/assets/blog/javaScript/graphql-2.png\" width=\"49%\" alt=\"post image\"/\u003e\n\u003cimg src=\"/assets/blog/javaScript/graphql-1.png\" width=\"49%\" alt=\"post image\"/\u003e\n\n`playground`에서 정의된 `schema`를 다운로드 받아 프로젝트 `root`에 위치시킵니다.\n\n```ts\n// const client = ...\n\nclient\n  .query({\n    query: gql`\n      query {\n        getAdminOrderProducts {\n          data {\n            id\n            status\n          }\n        }\n      }\n    `\n  })\n  .then((response) =\u003e console.log(response))\n  .catch((error) =\u003e console.log(error))\n```\n\n간단하게 불러올 수 있는 방법입니다. playground에 정의된 query를 요청하면\n타입과 함께 요청한 쿼리들이 response에 담깁니다.\n\n\u003cimg src=\"/assets/blog/javaScript/graphql-3.png\" width=\"49%\" alt=\"post image\"/\u003e\n\u003cimg src=\"/assets/blog/javaScript/graphql-4.png\" width=\"49%\" alt=\"post image\"/\u003e\n\n필드별로 분리하여 요청할 수 있습니다.\n```ts\nimport {gql, useQuery} from '@apollo/client'\n\nconst ORDER_QUERY = gql`\n  query {\n    getAdminOrderProducts {\n      data {\n        id\n        status\n      }\n    }\n  }\n`\n\n  const {loading, error, data} = useQuery(ORDER_QUERY)\n```\n\n`variables`로 `arguments`를 지정할 수 있습니다.\n\n`useQuery`에 옵션 `variables`은 GraphQL 쿼리에 전달하려는 모든 매개변수를 포함하는 객체입니다.\n\n아래와 같이 매개변수를 지정할 수 있습니다.\n```ts\nconst ORDER_QUERY = gql`\n  query getAdminOrderProducts($start: Int!, $perPage: Int!) {\n    getAdminOrderProducts(start: $start, perPage: $perPage) {\n      data {\n        id\n        status\n        product {\n          id\n        }\n        createdAt\n      }\n      total\n    }\n  }\n`\n\n  const {data, loading} = useQuery(ORDER_QUERY, {\n    variables: {\n      start: 0,\n      perPage: 20\n    }\n  })\n```\n\n지금까지는 백엔드의 데이터를 읽는 방법이었습니다.\n\n\n\n\n\n\n\n"])</script><script>self.__next_f.push([1,"1a:Tc85,"])</script><script>self.__next_f.push([1,"\n대기열 → 캐싱 → DNS → 라우팅 → ARP → 초기연결 → 컨텐츠 다운로드 → 브라우저 렌더링\n\n이런 과정을 비캡슐화, 캡슐화 과정을 거침\n\n### 대기열\n\n### 캐싱\n\n- 공유프록시캐시\n- 브라우저 캐시\n\n요청된 값의 결과값을 저장하고 다시 요청하는 기술\n\n브라우저는 IP주소를 찾기 위해 캐시된 DNS 기록을 확인\n\n### DNS 조회\n\n- 브라우저가 IP 주소를 확인하는 단계\n- 도메인 이름과 IP주소를 매핑해주는 서버\n- `www.naver.com` ← 반대로 확인\n- root (.) → .com → naver.com → `www.naver.com`\n\n### 라우팅\n\n- IP주소를 찾아가는 과정\n- 홉 바이 홉 통신\n\n### ARP (**IP 주소를 물리적 네트워크 주소로 대응(bind)시키기 위해 사용되는 프로토콜)**\n\n- ARP를 통해 MAC주소를 찾아 MAC주소를 기반으로 통신\n- 논리적 주소 → 물리적 주소\n- 장치 ↔ 장치 (IP주소를 → MAC주소)\n- 실제 서버에 도달\n\n### 초기 연결\n\n### 콘텐츠 다운로드\n\n- 브라우저는 서버로부터 응답을 수신\n\n### 브라우저 렌더링\n\n- DOM 트리 구축\n- HTML, CSS가 각각 파서로 해석되다가 DOM트리를 구축한다.\n- html, body, div 등 tree형태로\n- 렌더트리와 렌더레이어 생성\n- CSSOM 트리가 생성되고 미리 만들어 놓은 DOM트리 내에 있는 노드와 함께 스타일이 생성\n- 렌더레이어 대상으로 Layout 설정\n- 렌더레이어 대상으로 칠하기 (paint 과정)\n- 레이어 합치기\n- 각각의 레이어들이 합쳐짐\n\n일반적인 모니터는 초당 60FPS, 브라우저도 초당 60FPS로 화면을 그리게 된다.\n\n여기서 브라우저가 60FPS 아래로 그리게 된다면 쟁크 현상이 발생함.\n\n\u003cimg src=\"/assets/blog/javaScript/web-optimization6.png\" width=\"100%\" alt=\"web-optimization\"/\u003e\n\n1. DOM + CSSOM\n\n\u003cimg src=\"/assets/blog/javaScript/web-optimization7.png\" width=\"100%\" alt=\"web-optimization\"/\u003e\n\n1. Render Tree\n\n\u003cimg src=\"/assets/blog/javaScript/web-optimization8.png\" width=\"100%\" alt=\"web-optimization\"/\u003e\n\n위 DOM과 CSSOM을 조합해 RenderTree를 만들어 낸다.\n\n1. Layout\n\n\u003cimg src=\"/assets/blog/javaScript/web-optimization9.png\" width=\"100%\" alt=\"web-optimization\"/\u003e\n\n위치나 크기를 계산해 화면에 레이아웃을 그린다.\n\n1. Paint\n\n이렇게 그려진 레이아웃위에 색을 채워넣음\n\n1. Composite\n\n\u003cimg src=\"/assets/blog/javaScript/web-optimization10.png\" width=\"100%\" height=\"350\" alt=\"web-optimization\"/\u003e\n\n각 레이어들을 합성하는 과정\n\n이 전체의 과정을 Critical Rendering Path, Pixel Pipeline 이라고 부른다.\n\n이 완성된 상태에서 변화가 생긴다면 처음으로 돌아가 다시 이 전체의 과정을 거치게 된다.\n\n- width, height가 변경되면, **1 -\u003e 2 -\u003e 3 -\u003e 4 -\u003e 5** 모두 실행되게 된다 **(Reflow)**\n- 크기나 위치가 아니라 color, background-color(색깔)이 변경됐을땐 **1 -\u003e 2 -\u003e 4 -\u003e 5** **(Repaint)**\n- transform, opacity 등(GPU가 관여하는 속성) 변경일 때 **1 -\u003e 2 -\u003e 5**\n\n따라서 transform, opacity 등(GPU가 관여하는 속성)을 사용하는게 가장 빠르고 끊김없이 보여줄 수 있다.\n"])</script><script>self.__next_f.push([1,"1b:T1a75,"])</script><script>self.__next_f.push([1,"\n인증방식에는 대표적으로 두가지가 있다.\n\n제일 많이 사용하는 세션 방식과 토큰 방식\n\n- 인증 -\u003e 유저가 누구인지 확인\n- 인가 -\u003e 유저의 요청에 대한 권한을 확인하고 허가\n\n---\n\n### 세션방식\n- 로그인 요청 -\u003e 서버에서 세션 key-value로 구분해 정보를 저장\n- 서버 -\u003e 클라이언트 측으로 http header cookie에 세션 id를 담아 전달\n- 클라이언트 쪽에서 response값으로 cookie에 저장된 세션을 확인할 수 있는데, 브라우저에 저장\n\n세션 방식은 HTTP요청이 노출되어도 세션 자체에는 의미있는 값이 없기 때문에 보안상 유리할 수 있다.\n\n각 사용자마다 고유한 id를 갖고 있기 때문에 매번 회원정보를 확인할 필요가 없다.\n\n서버에 따로 세션 저장소를 두기 때문에 사용자가 많아지면 서버에 부담이 간다.\n\n각 브라우저들은 보안상의 이슈로 서버와 프론트간의 도메인이 같아야 쿠키가 전달된다.\n\n- 프론트 측에서는 Axios 사용시 ```withCredentials: true```설정을 통해 서로 다른 도메인간의 요청에도 credential 정보를 받을 것인지 설정해야 한다.\n\n- 서버 측에서는 응답 헤더의 Access-Control-Allow-Credentials 항목을 true로 설정해야 하고,\n응답 헤더의 Access-Control-Allow-Origin의 값을 와일드 카드('*') 제외하고 설정 되어야 한다.\n\n---\n\n우선 localhost와 서버상의 도메인이 달라 proxy 설정을 해줬다.\n\n```ts\n// pages/api/[...path].ts\nimport type { NextApiRequest, NextApiResponse } from \"next\";\nimport httpProxyMiddleware from \"next-http-proxy-middleware\";\n\nexport const config = {\n  api: {\n    externalResolver: true\n  },\n}\n\nexport default (req: NextApiRequest, res: NextApiResponse) =\u003e {\n    httpProxyMiddleware(req, res, {\n        target: process.env.NEXT_PUBLIC_API_URL,\n        changeOrigin: true,\n        pathRewrite: [\n          {\n            patternStr: \"^/api/\",\n            replaceStr: \"/\",\n          },\n        ],\n        cookieDomainRewrite: {\n          \"*\": \"localhost\",\n        },\n      })\n    };\n```\n\n```ts\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  swcMinify: true,\n  reactStrictMode: true,\n  compiler: {\n    styledComponents: true,\n    removeConsole: process.env.NODE_ENV === \"production\",\n  },\n  async rewrites() {\n    return process.env.NODE_ENV === \"production\"\n      ? [\n          {\n            source: \"/api/:path*\",\n            destination: `${process.env.NEXT_PUBLIC_API_URL}/:path*`,\n          },\n        ]\n      : [];\n  },\n{...}\n};\n```\n---\n위 처럼 설정해 주니 서버에서 보낸 cookie가 localhost 브라우저에 잘 들어왔다.\n\n여기서 고민했던 부분이 csr환경이 아닌 next의 ssr환경인 프론트측 서버단에서는 유저인증을 어떻게 확인할 것인가 였다.\n\n우선 로그인 상태와 비로그인 상태에서 접근불가능한 페이지 접근시 리다이렉트를 시키는 방법으로 진행했다.\n\nNextjs middleware는 root폴더에 middleware.ts 파일을 만들어 주면 페이지 라우팅 되기 전에 middleware가 자동으로 실행된다.\n\nNextjs에서 지원하는 middleware는 들어오는 요청에 따라서 req, res, header를 다시 작성하거나 리디렉션 등을 수정하거나 재작성할 수 있다.\n```ts\nimport type { NextRequest } from \"next/server\";\nimport { fetchAuth, inValidateAuth, validateAuth } from \"@/lib/validateUser\";\n\nconst validatedUrl = [\n  \"/users/sign-in\",\n  \"/users/sign-up/normal\",\n  \"/users/sign-up/social\",\n  \"/users/sign-up/vendor\",\n  \"/users/password/reset\",\n];\n\nconst inValidateUrl = [\"/users/my-page\"];\n\nexport async function middleware(req: NextRequest) {\n  const url = req.nextUrl;\n\n  if (validatedUrl.includes(url.pathname)) {\n    return await validateAuth(req);\n  }\n\n  if (inValidateUrl.includes(url.pathname)) {\n    return await inValidateAuth(req);\n  }\n\n  return await fetchAuth(req);\n}\n\nexport const config = {\n  matcher: [\"/((?!api|_next/static|_next/image|favicon.ico|assets).*)\"],\n};\n```\n```ts\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport const validateUser = (req: NextRequest) =\u003e {\n  return fetch(\"url\", {\n    method: \"get\",\n    mode: \"cors\",\n    credentials: \"same-origin\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      cookie: `${req.headers.get(\"cookie\")}`,\n    },\n  });\n};\n\n{...}\n\nexport const fetchAuth = async (req: NextRequest) =\u003e {\n    try {\n        const res = NextResponse.next();\n\n        const response = await validateUser(req);\n        const data = await response.json();\n\n        if (response.ok) {\n            res.cookies.set(\"user\", JSON.stringify(data));\n            return res;\n        }\n\n        if (!response.ok) {\n            res.cookies.delete(\"user\");\n            res.cookies.delete(\"user.sid\");\n            return res;\n        }\n    } catch (e) {\n        throw new Error(\"Validate Error\");\n    }\n};\n```\n\n처음에 이런식으로 미들웨어를 구현했다. matcher로 페이지단만 확인했고, 페이지 라우팅시 유저 인증에 성공하면 cookie를 통해 유저정보와 세션을 전달했다.\n\n또 인증성공시 접근 x, 비인증시 접근 x 한 url을 확인해 리다이렉트 시키도록 했다.\n\n처음 해봤던 작업이었고, 제대로 구현한지 확신이 들지 않아 코드리뷰를 요청했다.\n\nmiddleware를 사용하지 않고 hocs를 사용해 auth를 호출하고, axios config에 headers를 전달하는 방법으로 알려주셨다.\n\n```ts\nimport React from \"react\";\nimport { GetServerSideProps, GetServerSidePropsContext } from \"next\";\nimport { getAuth } from \"@/models/auth\";\nimport merge from \"lodash/merge\";\n\nconst validatedUrl = [\n  \"/users/sign-in\",\n  \"/users/sign-up/normal\",\n  \"/users/sign-up/social\",\n  \"/users/sign-up/vendor\",\n  \"/users/password/reset\",\n];\n\nconst inValidateUrl = [\n  \"/users/my-page\",\n  \"/users/my-page/profile\",\n  \"/users/my-page/review\",\n];\n\nexport default function withAuth(getServerSideProps?: GetServerSideProps) {\n  return async function (context: GetServerSidePropsContext) {\n    const url = context.req.url as string;\n    let user = null;\n    try {\n      const res = await getAuth({ headers: context.req.headers });\n      user = res.data;\n    } catch (e) {}\n    if (inValidateUrl.includes(url) \u0026\u0026 !user) {\n      return {\n        redirect: {\n          permanent: false,\n          destination: \"/users/sign-in\",\n        },\n      };\n    }\n    {...}\n    const ret = await getServerSideProps?.(context);\n    return merge(ret, { props: { user } });\n  };\n}\n```\n\nmiddleware는 nextjs에서 서버도 같이 구성해 사용하면 좋을거라고 조언을 주셨다.\n\n```ts\n// page/*\n{...}\n\nexport const getServerSideProps = withAuth();\n\n{...}\n```\n"])</script><script>self.__next_f.push([1,"7:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/bee2c35e5d2aa945.css\",\"precedence\":\"next\"}]],[\"$\",\"$L8\",null,{\"buildId\":\"Nc7yPCvx4Q09YMfwxNoS9\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/page/1\",\"initialTree\":[\"\",{\"children\":[\"page\",{\"children\":[[\"page\",\"1\",\"d\"],{\"children\":[\"__PAGE__?{\\\"page\\\":\\\"1\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L9\"],\"globalErrorComponent\":\"$a\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"ko\",\"children\":[null,[\"$\",\"$Lb\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-LFDRQZPCBN\"}],[\"$\",\"$Lb\",null,{\"id\":\"google-analytics\",\"children\":\"\\n          window.dataLayer = window.dataLayer || [];\\n          function gtag(){dataLayer.push(arguments);}\\n          gtag('js', new Date());\\n \\n          gtag('config', 'G-LFDRQZPCBN');\\n        \"}],[\"$\",\"body\",null,{\"suppressHydrationWarning\":true,\"className\":\"__className_471caf\",\"children\":[[\"$\",\"header\",null,{\"className\":\"sticky top-0 z-10 mx-auto my-0 h-[56px] border-b-[1px] border-b-gray200 bg-white px-[24px] py-0\",\"children\":[\"$\",\"section\",null,{\"className\":\"m-auto flex h-full max-w-[970px] items-center justify-between\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-[20px]\",\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":[\"$\",\"$Ld\",null,{\"src\":\"/assets/icons/been-logo.svg\",\"width\":60,\"height\":56,\"alt\":\"logo\"}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-[20px]\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/about\",\"children\":\"About\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-[20px]\",\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"https://github.com/wonbeenna\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"$\",\"$Ld\",null,{\"src\":\"/assets/icons/github.svg\",\"width\":30,\"height\":30,\"alt\":\"github\"}]}],[\"$\",\"$Lc\",null,{\"href\":\"mailto:nwbnwb@naver.com\",\"children\":[\"$\",\"$Ld\",null,{\"src\":\"/assets/icons/mail.svg\",\"width\":34,\"height\":34,\"alt\":\"email\"}]}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"mx-auto my-0 max-w-[970px] p-[16px]\",\"children\":[\"$\",\"$Le\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lf\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$Le\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"page\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lf\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Le\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"page\",\"children\",[\"page\",\"1\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lf\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L10\",[\"$\",\"section\",null,{\"className\":\"flex flex-col-reverse md:relative md:flex-row\",\"children\":[[\"$\",\"$L11\",null,{\"posts\":{\"posts\":[{\"content\":\"$12\",\"data\":{\"title\":\"웹팩 기본 사용법 (1)\",\"date\":\"$D2023-11-30T00:00:00.000Z\",\"description\":\"처음 접해보는 웹팩의 원리와 기본 사용 방법\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/webpack-icon.svg\"},\"slug\":\"webpack-babel\"},{\"content\":\"$13\",\"data\":{\"title\":\"React Native geolocation\",\"date\":\"$D2023-10-25T00:00:00.000Z\",\"description\":\"React Native 위치정보 받아오기\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/logo192.png\"},\"slug\":\"rn-geolocation\"},{\"content\":\"$14\",\"data\":{\"title\":\"React Native Deep Linking\",\"date\":\"$D2023-10-17T00:00:00.000Z\",\"description\":\"React Native Deep Linking 연결\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/logo192.png\"},\"slug\":\"rn-deep-link\"},{\"content\":\"$15\",\"data\":{\"title\":\"Next.js 블로그 만들기\",\"date\":\"$D2023-10-09T00:00:00.000Z\",\"description\":\"Next.js로 블로그 만들기\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/Nextjs.svg\"},\"slug\":\"next-blog\"},{\"content\":\"$16\",\"data\":{\"title\":\"jwt 토큰 decode 하기\",\"date\":\"$D2023-08-31T00:00:00.000Z\",\"description\":\"jwt 토큰 decode 함수\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/javascript.png\"},\"slug\":\"jwt-decode\"},{\"content\":\"$17\",\"data\":{\"title\":\"Audio객체를 이용한 음악 재생\",\"date\":\"$D2023-05-27T00:00:00.000Z\",\"description\":\"Audio객체를 사용한 기업 과제 구현\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/logo192.png\"},\"slug\":\"audio\"},{\"content\":\"$18\",\"data\":{\"title\":\"디바운싱과 쓰로틀링\",\"date\":\"$D2023-05-13T00:00:00.000Z\",\"description\":\"디바운싱과 쓰로틀링의 차이를 구분하고 hook으로 구현\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/javascript.png\"},\"slug\":\"debouce-throttle\"},{\"content\":\"$19\",\"data\":{\"title\":\"GraphQl 써보기(1)\",\"date\":\"$D2023-04-29T00:00:00.000Z\",\"description\":\"GraphQl, Apollo Client를 사용\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/graphql.svg\"},\"slug\":\"graphql-1\"},{\"content\":\"$1a\",\"data\":{\"title\":\"브라우저에 url을 검색하면?\",\"date\":\"$D2023-02-25T00:00:00.000Z\",\"description\":\"사내 스터디\",\"category\":\"study\",\"titleImage\":\"/assets/postIcon/javascript.png\"},\"slug\":\"browser\"},{\"content\":\"$1b\",\"data\":{\"title\":\"Next.js middleware와 getServerSideProps\",\"date\":\"$D2023-02-22T00:00:00.000Z\",\"description\":\"세션방식의 로그인 인증, middleware와 getServerSideProps를 사용해 구현한 기록\",\"category\":\"javaScript\",\"titleImage\":\"/assets/postIcon/Nextjs.svg\"},\"slug\":\"next-middleware\"}],\"total\":33},\"page\":\"1\",\"category\":\"$undefined\"}],[\"$\",\"ul\",null,{\"className\":\"relative top-0 flex h-fit min-w-fit flex-row flex-wrap gap-[20px] py-[20px] pl-0 md:sticky md:top-[100px] md:flex-col md:flex-nowrap md:py-0 md:pl-[30px]\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"hidden text-[18px] font-bold md:inline\",\"children\":\"Category\"}],[[\"$\",\"li\",\"javaScript\",{\"children\":[\"$\",\"$Lc\",null,{\"className\":\"text-gray700\",\"href\":\"/blog/javaScript\",\"children\":\"javaScript (30)\"}]}],[\"$\",\"li\",\"study\",{\"children\":[\"$\",\"$Lc\",null,{\"className\":\"text-gray700\",\"href\":\"/blog/study\",\"children\":\"study (2)\"}]}],[\"$\",\"li\",\"til\",{\"children\":[\"$\",\"$Lc\",null,{\"className\":\"text-gray700\",\"href\":\"/blog/til\",\"children\":\"til (1)\"}]}]]]}]]}],null],\"segment\":\"__PAGE__?{\\\"page\\\":\\\"1\\\"}\"},\"styles\":[]}],\"segment\":[\"page\",\"1\",\"d\"]},\"styles\":[]}],\"segment\":\"page\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"flex items-center justify-center pb-[16px] text-center text-[14px] text-gray600\",\"children\":\"Copyright © Been.\"}]]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Been blog - 1\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Been dev-note\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"BirkRt7C7FYMLW96RbXad2EtPdcl0-_ti9xCRkCHa5U\"}],[\"$\",\"meta\",\"5\",{\"name\":\"naver-site-verification\",\"content\":\"58945b2bbe2fe86252fa8c7b204b40f6019920e9\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Been blog - 1\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"Been dev-note - 1\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://wonbeenna.github.io/page/1\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:site_name\",\"content\":\"Been blog\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image\",\"content\":\"https://wonbeenna.github.io/favicon.png\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:image:width\",\"content\":\"800\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image:height\",\"content\":\"600\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image:alt\",\"content\":\"Been blog\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:title\",\"content\":\"Been blog - 1\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:description\",\"content\":\"Been dev-note - 1\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:image\",\"content\":\"https://wonbeenna.github.io/favicon.png\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:image:width\",\"content\":\"800\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:image:height\",\"content\":\"600\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:image:alt\",\"content\":\"Been blog\"}],[\"$\",\"link\",\"22\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"192x192\"}],[\"$\",\"meta\",\"23\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"10:null\n"])</script></body></html>